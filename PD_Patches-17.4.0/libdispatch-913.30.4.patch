diff -rwU5 A/libdispatch-913.30.4/libdispatch.xcodeproj/project.pbxproj B/libdispatch-913.30.4/libdispatch.xcodeproj/project.pbxproj
--- A/libdispatch-913.30.4/libdispatch.xcodeproj/project.pbxproj	2017-07-26 21:08:15.000000000 +0100
+++ B/libdispatch-913.30.4/libdispatch.xcodeproj/project.pbxproj	2018-07-02 12:57:15.000000000 +0100
@@ -106,16 +106,10 @@
 		6E5ACCBB1D3C4D0E007DA2B4 /* event_internal.h in Headers */ = {isa = PBXBuildFile; fileRef = 6E5ACCB91D3C4D0B007DA2B4 /* event_internal.h */; };
 		6E5ACCBC1D3C4D0F007DA2B4 /* event_internal.h in Headers */ = {isa = PBXBuildFile; fileRef = 6E5ACCB91D3C4D0B007DA2B4 /* event_internal.h */; };
 		6E90269C1BB9BD50004DC3AD /* firehose.defs in Sources */ = {isa = PBXBuildFile; fileRef = 72DEAA9B1AE1B0BD00289540 /* firehose.defs */; settings = {ATTRIBUTES = (Server, ); }; };
 		6E9955581C3AF7710071D40C /* venture_private.h in Headers */ = {isa = PBXBuildFile; fileRef = 6E9955571C3AF7710071D40C /* venture_private.h */; };
 		6E99558A1C3AF7900071D40C /* venture_private.h in Headers */ = {isa = PBXBuildFile; fileRef = 6E9955571C3AF7710071D40C /* venture_private.h */; };
-		6E9955CF1C3B218E0071D40C /* venture.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E9955CE1C3B218E0071D40C /* venture.c */; };
-		6E9956011C3B21980071D40C /* venture.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E9955CE1C3B218E0071D40C /* venture.c */; };
-		6E9956021C3B21990071D40C /* venture.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E9955CE1C3B218E0071D40C /* venture.c */; };
-		6E9956031C3B219A0071D40C /* venture.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E9955CE1C3B218E0071D40C /* venture.c */; };
-		6E9956041C3B219B0071D40C /* venture.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E9955CE1C3B218E0071D40C /* venture.c */; };
-		6E9956051C3B219B0071D40C /* venture.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E9955CE1C3B218E0071D40C /* venture.c */; };
 		6E9956071C3B21AA0071D40C /* venture_internal.h in Headers */ = {isa = PBXBuildFile; fileRef = 6E9956061C3B21AA0071D40C /* venture_internal.h */; };
 		6E9956081C3B21B30071D40C /* venture_internal.h in Headers */ = {isa = PBXBuildFile; fileRef = 6E9956061C3B21AA0071D40C /* venture_internal.h */; };
 		6E9956091C3B21B40071D40C /* venture_internal.h in Headers */ = {isa = PBXBuildFile; fileRef = 6E9956061C3B21AA0071D40C /* venture_internal.h */; };
 		6E9B6B5F1BB4F3C8009E324D /* firehose_buffer_internal.h in Headers */ = {isa = PBXBuildFile; fileRef = 6E9B6B201BB4CC73009E324D /* firehose_buffer_internal.h */; };
 		6EA283D71CAB93920041B2E0 /* libdispatch.codes in Copy Trace Definitions */ = {isa = PBXBuildFile; fileRef = 6EA283D01CAB93270041B2E0 /* libdispatch.codes */; };
@@ -331,11 +325,10 @@
 		E48EC97C1835BADD00EAC4F1 /* yield.h in Headers */ = {isa = PBXBuildFile; fileRef = E48EC97B1835BADD00EAC4F1 /* yield.h */; };
 		E48EC97D1835BADD00EAC4F1 /* yield.h in Headers */ = {isa = PBXBuildFile; fileRef = E48EC97B1835BADD00EAC4F1 /* yield.h */; };
 		E48EC97E1835BADD00EAC4F1 /* yield.h in Headers */ = {isa = PBXBuildFile; fileRef = E48EC97B1835BADD00EAC4F1 /* yield.h */; };
 		E49BB6D11E70748100868613 /* provider.d in Sources */ = {isa = PBXBuildFile; fileRef = E43570B8126E93380097AB9F /* provider.d */; };
 		E49BB6D21E70748100868613 /* protocol.defs in Sources */ = {isa = PBXBuildFile; fileRef = FC7BED950E8361E600161930 /* protocol.defs */; settings = {ATTRIBUTES = (Client, Server, ); }; };
-		E49BB6D31E70748100868613 /* venture.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E9955CE1C3B218E0071D40C /* venture.c */; };
 		E49BB6D41E70748100868613 /* firehose.defs in Sources */ = {isa = PBXBuildFile; fileRef = 72DEAA9B1AE1B0BD00289540 /* firehose.defs */; };
 		E49BB6D51E70748100868613 /* firehose_buffer.c in Sources */ = {isa = PBXBuildFile; fileRef = 72DEAA971AE181D300289540 /* firehose_buffer.c */; };
 		E49BB6D61E70748100868613 /* event_kevent.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E5ACCB01D3C4CFB007DA2B4 /* event_kevent.c */; };
 		E49BB6D71E70748100868613 /* resolver.c in Sources */ = {isa = PBXBuildFile; fileRef = E44EBE371251656400645D88 /* resolver.c */; };
 		E49BB6D81E70748100868613 /* mach.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E4BACBC1D48A41500B562AE /* mach.c */; };
@@ -358,11 +351,10 @@
 		E49BB6E91E70748100868613 /* transform.c in Sources */ = {isa = PBXBuildFile; fileRef = C9C5F80D143C1771006DC718 /* transform.c */; };
 		E49BB6EA1E70748100868613 /* object.m in Sources */ = {isa = PBXBuildFile; fileRef = E4FC3263145F46C9002FBDDB /* object.m */; };
 		E49BB6EB1E70748100868613 /* allocator.c in Sources */ = {isa = PBXBuildFile; fileRef = 2BBF5A62154B64F5002B20F9 /* allocator.c */; };
 		E49BB6EC1E70748100868613 /* data.m in Sources */ = {isa = PBXBuildFile; fileRef = E420866F16027AE500EEE210 /* data.m */; };
 		E49BB6ED1E70748100868613 /* voucher.c in Sources */ = {isa = PBXBuildFile; fileRef = E44A8E6A1805C3E0009FFDB6 /* voucher.c */; };
-		E49BB7091E70A39700868613 /* venture.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E9955CE1C3B218E0071D40C /* venture.c */; };
 		E49BB70A1E70A3B000868613 /* venture.c in Sources */ = {isa = PBXBuildFile; fileRef = 6E9955CE1C3B218E0071D40C /* venture.c */; };
 		E49F2423125D3C960057C971 /* resolver.c in Sources */ = {isa = PBXBuildFile; fileRef = E44EBE371251656400645D88 /* resolver.c */; };
 		E49F2424125D3C970057C971 /* resolver.c in Sources */ = {isa = PBXBuildFile; fileRef = E44EBE371251656400645D88 /* resolver.c */; };
 		E49F2499125D48D80057C971 /* resolver.c in Sources */ = {isa = PBXBuildFile; fileRef = E44EBE371251656400645D88 /* resolver.c */; };
 		E49F24AB125D57FA0057C971 /* dispatch.h in Headers */ = {isa = PBXBuildFile; fileRef = FC7BED960E8361E600161930 /* dispatch.h */; settings = {ATTRIBUTES = (Public, ); }; };
@@ -1964,19 +1956,17 @@
 			);
 			inputPaths = (
 				"$(SRCROOT)/xcodescripts/install-headers.sh",
 				"$(SRCROOT)/os/object.h",
 				"$(SRCROOT)/os/object_private.h",
-				"$(SRCROOT)/os/venture_private.h",
 				"$(SRCROOT)/os/voucher_private.h",
 				"$(SRCROOT)/os/voucher_activity_private.h",
 			);
 			name = "Install Headers";
 			outputPaths = (
 				"$(CONFIGURATION_BUILD_DIR)/$(OS_PUBLIC_HEADERS_FOLDER_PATH)/object.h",
 				"$(CONFIGURATION_BUILD_DIR)/$(OS_PRIVATE_HEADERS_FOLDER_PATH)/object_private.h",
-				"$(CONFIGURATION_BUILD_DIR)/$(OS_PRIVATE_HEADERS_FOLDER_PATH)/venture_private.h",
 				"$(CONFIGURATION_BUILD_DIR)/$(OS_PRIVATE_HEADERS_FOLDER_PATH)/voucher_private.h",
 				"$(CONFIGURATION_BUILD_DIR)/$(OS_PRIVATE_HEADERS_FOLDER_PATH)/voucher_activity_private.h",
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 			shellPath = "/bin/bash -e";
@@ -2173,11 +2163,10 @@
 				C01866B61C5973210040FC07 /* data.c in Sources */,
 				C01866B81C5973210040FC07 /* transform.c in Sources */,
 				C01866B51C5973210040FC07 /* time.c in Sources */,
 				C01866B91C5973210040FC07 /* allocator.c in Sources */,
 				C01866B31C5973210040FC07 /* benchmark.c in Sources */,
-				E49BB7091E70A39700868613 /* venture.c in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
 		D2AAC044055464E500DB518D /* Sources */ = {
 			isa = PBXSourcesBuildPhase;
@@ -2209,11 +2198,10 @@
 				E420867016027AE500EEE210 /* data.m in Sources */,
 				C9C5F80E143C1771006DC718 /* transform.c in Sources */,
 				96032E4B0F5CC8C700241C5F /* time.c in Sources */,
 				2BBF5A63154B64F5002B20F9 /* allocator.c in Sources */,
 				965CD6350F3E806200D4E28D /* benchmark.c in Sources */,
-				6E9955CF1C3B218E0071D40C /* venture.c in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
 		E46DBC3E14EE10C80001F9F6 /* Sources */ = {
 			isa = PBXSourcesBuildPhase;
@@ -2242,11 +2230,10 @@
 				E46DBC4B14EE10C80001F9F6 /* data.c in Sources */,
 				E46DBC4D14EE10C80001F9F6 /* transform.c in Sources */,
 				E46DBC4A14EE10C80001F9F6 /* time.c in Sources */,
 				2BBF5A67154B64F5002B20F9 /* allocator.c in Sources */,
 				E46DBC4814EE10C80001F9F6 /* benchmark.c in Sources */,
-				6E9956011C3B21980071D40C /* venture.c in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
 		E49BB6D01E70748100868613 /* Sources */ = {
 			isa = PBXSourcesBuildPhase;
@@ -2278,11 +2265,10 @@
 				E49BB6EC1E70748100868613 /* data.m in Sources */,
 				E49BB6E91E70748100868613 /* transform.c in Sources */,
 				E49BB6E41E70748100868613 /* time.c in Sources */,
 				E49BB6EB1E70748100868613 /* allocator.c in Sources */,
 				E49BB6E11E70748100868613 /* benchmark.c in Sources */,
-				E49BB6D31E70748100868613 /* venture.c in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
 		E49F24C7125D57FA0057C971 /* Sources */ = {
 			isa = PBXSourcesBuildPhase;
@@ -2314,11 +2300,10 @@
 				E420867116027AE500EEE210 /* data.m in Sources */,
 				C93D6165143E190E00EB9023 /* transform.c in Sources */,
 				E49F24D2125D57FA0057C971 /* time.c in Sources */,
 				2BBF5A64154B64F5002B20F9 /* allocator.c in Sources */,
 				E49F24D0125D57FA0057C971 /* benchmark.c in Sources */,
-				6E9956051C3B219B0071D40C /* venture.c in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
 		E4B515BC164B2DA300E003AF /* Sources */ = {
 			isa = PBXSourcesBuildPhase;
@@ -2350,11 +2335,10 @@
 				E4B515CE164B2DA300E003AF /* data.m in Sources */,
 				E4B515CB164B2DA300E003AF /* transform.c in Sources */,
 				E4B515C8164B2DA300E003AF /* time.c in Sources */,
 				E4B515CD164B2DA300E003AF /* allocator.c in Sources */,
 				E4B515C6164B2DA300E003AF /* benchmark.c in Sources */,
-				6E9956021C3B21990071D40C /* venture.c in Sources */,
 				E4B515DD164B32E000E003AF /* introspection.c in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
 		E4EC11AC12514302000DDBD1 /* Sources */ = {
@@ -2387,11 +2371,10 @@
 				E420867316027AE500EEE210 /* data.m in Sources */,
 				C93D6166143E190F00EB9023 /* transform.c in Sources */,
 				E4EC11B512514302000DDBD1 /* time.c in Sources */,
 				2BBF5A65154B64F5002B20F9 /* allocator.c in Sources */,
 				E4EC11B312514302000DDBD1 /* benchmark.c in Sources */,
-				6E9956031C3B219A0071D40C /* venture.c in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
 		E4EC121812514715000DDBD1 /* Sources */ = {
 			isa = PBXSourcesBuildPhase;
@@ -2423,11 +2406,10 @@
 				E420867216027AE500EEE210 /* data.m in Sources */,
 				C93D6167143E190F00EB9023 /* transform.c in Sources */,
 				E4EC122112514715000DDBD1 /* time.c in Sources */,
 				2BBF5A66154B64F5002B20F9 /* allocator.c in Sources */,
 				E4EC121F12514715000DDBD1 /* benchmark.c in Sources */,
-				6E9956041C3B219B0071D40C /* venture.c in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
 /* End PBXSourcesBuildPhase section */
 
Only in B/libdispatch-913.30.4/libdispatch.xcodeproj: project.xcworkspace
Only in B/libdispatch-913.30.4/libdispatch.xcodeproj: xcuserdata
Only in B/libdispatch-913.30.4: obj
diff -rwU5 A/libdispatch-913.30.4/src/shims/atomic.h B/libdispatch-913.30.4/src/shims/atomic.h
--- A/libdispatch-913.30.4/src/shims/atomic.h	2017-10-09 23:12:40.000000000 +0100
+++ B/libdispatch-913.30.4/src/shims/atomic.h	2018-07-02 12:57:15.000000000 +0100
@@ -148,10 +148,14 @@
 #define os_atomic_dec2o(p, f, m) \
 		os_atomic_sub2o(p, f, 1, m)
 #define os_atomic_dec_orig2o(p, f, m) \
 		os_atomic_sub_orig2o(p, f, 1, m)
 
+#if !defined(os_unlikely)
+#define os_unlikely(x)	__builtin_expect(!!(x), 0) /* from firehose_buffer.c */
+#endif
+
 #define os_atomic_rmw_loop(p, ov, nv, m, ...)  ({ \
 		bool _result = false; \
 		typeof(p) _p = (p); \
 		ov = os_atomic_load(_p, relaxed); \
 		do { \
Only in B/libdispatch-913.30.4: sym
Only in B/libdispatch-913.30.4: tests
diff -rwU5 A/libdispatch-913.30.4/xcodeconfig/libdispatch.xcconfig B/libdispatch-913.30.4/xcodeconfig/libdispatch.xcconfig
--- A/libdispatch-913.30.4/xcodeconfig/libdispatch.xcconfig	2018-02-03 22:20:32.000000000 +0000
+++ B/libdispatch-913.30.4/xcodeconfig/libdispatch.xcconfig	2018-07-02 12:57:15.000000000 +0100
@@ -74,11 +74,11 @@
 CLANG_WARN_SUSPICIOUS_MOVE = YES
 CLANG_WARN_UNREACHABLE_CODE = YES
 GCC_TREAT_WARNINGS_AS_ERRORS = YES
 GCC_OPTIMIZATION_LEVEL = s
 GCC_NO_COMMON_BLOCKS = YES
-GCC_PREPROCESSOR_DEFINITIONS = __DARWIN_NON_CANCELABLE=1 $(DISPATCH_PREPROCESSOR_DEFINITIONS)
+GCC_PREPROCESSOR_DEFINITIONS = __DARWIN_NON_CANCELABLE=1 $(DISPATCH_PREPROCESSOR_DEFINITIONS) TARGET_OS_EMBEDDED=0
 STATICLIB_PREPROCESSOR_DEFINITIONS = DISPATCH_VARIANT_STATIC=1 USE_OBJC=0 DISPATCH_USE_DTRACE=0
 WARNING_CFLAGS = -Wall -Wextra -Warray-bounds-pointer-arithmetic -Watomic-properties -Wcomma -Wconditional-uninitialized -Wcovered-switch-default -Wdate-time -Wdeprecated -Wdouble-promotion -Wduplicate-enum -Wexpansion-to-defined -Wfloat-equal -Widiomatic-parentheses -Wignored-qualifiers -Wimplicit-fallthrough -Wnullable-to-nonnull-conversion -Wobjc-interface-ivars -Wover-aligned -Wpacked -Wpointer-arith -Wselector -Wstatic-in-inline -Wsuper-class-method-mismatch -Wswitch-enum -Wtautological-compare -Wunguarded-availability -Wunused -Wno-unknown-warning-option $(NO_WARNING_CFLAGS)
 NO_WARNING_CFLAGS = -Wno-pedantic -Wno-bad-function-cast -Wno-c++-compat -Wno-c++98-compat -Wno-c++98-compat-pedantic -Wno-cast-align -Wno-cast-qual -Wno-disabled-macro-expansion -Wno-documentation-unknown-command -Wno-format-nonliteral -Wno-missing-variable-declarations -Wno-old-style-cast -Wno-padded -Wno-reserved-id-macro -Wno-shift-sign-overflow -Wno-undef -Wno-unreachable-code-aggressive -Wno-unused-macros -Wno-used-but-marked-unused -Wno-vla
 OTHER_CFLAGS = -fverbose-asm -isystem $(SDKROOT)/System/Library/Frameworks/System.framework/PrivateHeaders $(PLATFORM_CFLAGS)
 OTHER_CFLAGS[arch=i386][sdk=macosx*] = $(OTHER_CFLAGS) -fno-unwind-tables -fno-asynchronous-unwind-tables -fno-exceptions
diff -rwU5 A/libdispatch-913.30.4/xcodescripts/install-headers.sh B/libdispatch-913.30.4/xcodescripts/install-headers.sh
--- A/libdispatch-913.30.4/xcodescripts/install-headers.sh	2016-03-12 01:11:32.000000000 +0000
+++ B/libdispatch-913.30.4/xcodescripts/install-headers.sh	2018-07-02 12:57:15.000000000 +0100
@@ -27,6 +27,5 @@
 mkdir -p "${DSTROOT}${OS_PRIVATE_HEADERS_FOLDER_PATH}" || true
 cp -X "${SCRIPT_INPUT_FILE_1}" "${DSTROOT}${OS_PUBLIC_HEADERS_FOLDER_PATH}"
 cp -X "${SCRIPT_INPUT_FILE_2}" "${DSTROOT}${OS_PRIVATE_HEADERS_FOLDER_PATH}"
 cp -X "${SCRIPT_INPUT_FILE_3}" "${DSTROOT}${OS_PRIVATE_HEADERS_FOLDER_PATH}"
 cp -X "${SCRIPT_INPUT_FILE_4}" "${DSTROOT}${OS_PRIVATE_HEADERS_FOLDER_PATH}"
-cp -X "${SCRIPT_INPUT_FILE_5}" "${DSTROOT}${OS_PRIVATE_HEADERS_FOLDER_PATH}"
